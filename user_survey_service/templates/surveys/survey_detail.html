{% extends 'base.html' %}

{% block title %}Последние обновления на сайте{% endblock %}

{% block header %}Последние обновления на сайте{% endblock %}

{% block content %}
<div style="margin-left: 40px; margin-right: 40px; color: #333;"> 
    <h2 align="center">
        <span style="color: navy;">Текущий Опрос:</span>
        <span style="color: blue;"> "{{ survey.title }}"</span>
    </h2>
    <br>
    <h4 align="left">
        <span style="color: navy;">Тематика опроса:</span>
        <span style="color: color;"> "{{ survey.description }}"</span>
    </h4>
    <br>
    <a href="{{ question.get_next_question }}" class="btn btn-primary">
        &rarr;  <strong>Перейти к вопросам опроса : "{{ survey.title }}"</strong>
    </a>
{#    <a href="{% url 'surveys:survey_question' survey_slug=survey.slug question_slug=next_question.slug %}">#}
{#        !!!!Перейти к следующему вопросу#}
{#    </a>#}
{#    <a href="{% url 'surveys:survey_question' survey_slug=survey.slug question_slug=question.slug %}">#}
{#    Перейти к вопросу#}
{#    </a>#}
    <br>
    {% comment %} <a href="{% url 'surveys:survey_question' survey_slug=survey.slug question_slug=next_question_url %}">
        Перейти к вопросу!!!!
    </a> {% endcomment %}
    <br>
    <a href="{% url 'surveys:survey_list' %}" class="btn btn-secondary">
        &larr;  <strong>Вернуться к выбору другой темы для опроса</strong>
    </a>
    <br>
    <br>
    <a href="{% url 'surveys:survey_results' survey_slug=survey.slug %}" class="btn btn-info">
        &rarr; <strong>Посмотрите cтатистику результатов данного опроса: "{{ survey.title }}"</strong>
    </a>
    <br>
    <br>

    <div id="questionsContainer">
        <!-- Сюда будут загружаться вопросы -->
    </div>

    <button id="loadQuestionsBtn" class="btn btn-primary">
        Загрузить вопросы
    </button>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#loadQuestionsBtn").click(function () {
                var surveySlug = "{{ survey.slug }}";
    
                $.ajax({
                    url: `/surveys/${surveySlug}/load_questions/`,
                    method: "GET",
                    success: function (data) {
                        // Очищаем контейнер перед добавлением новых вопросов
                        $("#questionsContainer").empty();
    
                        // Обработка полученных данных (например, вывод вопросов)
                        if (Array.isArray(data.questions) && data.questions.length > 0) {
                            data.questions.forEach(function (questionData) {
                                var question = questionData.fields;
                                var questionHTML = `<div>
                                    <h3>${question.title || 'No title available'}</h3>`;
                                {% comment %} questionHTML += `<p>${question.text}</p>`; {% endcomment %}
    
                                // Обработка вариантов ответов
                                if (question.choices && question.choices.length > 0) {
                                    questionHTML += "<ul>";
                                    question.choices.forEach(function (choice) {
                                        questionHTML += `<li>${choice.fields.text}</li>`;
                                    });
                                    questionHTML += "</ul>";
                                }
    
                                questionHTML += "</div>";
    
                                // Добавляем вопрос в контейнер
                                $("#questionsContainer").append(questionHTML);
                            });
    
                            // Отображаем ссылку на следующий вопрос
                            $("#nextQuestionLink").show();
                        } else {
                            // Если вопросов нет
                            $("#questionsContainer").html("<p>Вопросов нет.</p>");
    
                            // Скрываем ссылку на следующий вопрос
                            $("#nextQuestionLink").hide();
                        }
                    },
                    error: function (error) {
                        console.error(error);
                    }
                });
            });
        });
    </script>
</div>
{% endblock %}